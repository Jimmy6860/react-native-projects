#!/usr/bin/env node

var argv = require('optimist').argv
  , sauce = require('sauce')
  , sl = require('saucelabs')
  , asciitable = require('asciitable')
  , colors = require('colors');

if (argv.creds) {
  console.log(sauce.sauce().creds());
}
else if (argv.rest) {
  var rest = new sl({
    username: sauce.sauce().creds().username,
    password: sauce.sauce().creds().accessKey
  });

  rest[argv.rest](function(err, res) {
    console.log(res);
  })
}
else if (argv.browser) {
  console.log('Getting you a browser...'.green.bold);
  sauce.sauce().go(argv, function(url) {
    console.log("");
    console.log("In a browser, goto: ".cyan);
    console.log("   "+url);
  });
}
else if (argv.browsers) {
  sauce.sauce().browsers(function(err, browsers) {
    var options = {
      skinny: true,
      intersectionCharacter: "x",
      columns: [
        {field: "api_name", name: "Browser"},
        {field: "long_version",  name: "Version"},
        {field: "os",  name: "Platform"},
      ],
    };

    var table = asciitable(options, browsers);
    console.log(table);
  })
}
else {
  console.log("Welcome to the Sauce Labs CLI, what shall we do? try..".green.bold);
  console.log("   --creds".yellow);
  console.log("   --browsers".yellow);
  console.log("   --rest".yellow);
  console.log("   --browser".yellow);
}
